[![Build Status](https://travis-ci.org/BorisChumichev/vkflow.svg?branch=master)](https://travis-ci.org/BorisChumichev/vkflow) [![Coverage Status](https://coveralls.io/repos/github/BorisChumichev/vkflow/badge.svg?branch=master)](https://coveralls.io/github/BorisChumichev/vkflow?branch=master)

# VK Streaming API –∫–ª–∏–µ–Ω—Ç –¥–ª—è Node

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Streaming API –í–ö–æ–Ω—Ç–∞–∫—Ç–µ:

1. –§–∞–±—Ä–∏–∫–∞ `vkflow` ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ç–æ–∫ —Å –∂–µ–ª–∞–µ–º—ã–º –Ω–∞–±–æ—Ä–æ–º [–ø—Ä–∞–≤–∏–ª](https://vk.com/dev/streaming_api_docs?f=2.%20%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB) –∏ —Å—á–∏—Ç—ã–≤–∞—Ç—å –∏–∑ –Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è;
2. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã `VKStreamingAPI` –∏ `VKWebSocket` –¥–ª—è —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞ —Ñ–∞–±—Ä–∏–∫–∞ `vkflow` –Ω–µ –¥–∞—ë—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å API.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```
npm install vkflow
```

## üç≠ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ `vkflow`

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å `vkflow` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É, –ø–µ—Ä–µ–¥–∞–≤ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ [—Å–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](https://vk.com/dev/access_token?f=3.%20%D0%A1%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BD%D1%8B%D0%B9%20%D0%BA%D0%BB%D1%8E%D1%87%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0) –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∏ –º–∞—Å—Å–∏–≤ [–ø—Ä–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏](https://vk.com/dev/streaming_api_docs?f=2.%20%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB).

##### –ü—Ä–∏–º–µ—Ä: —á—Ç–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º ¬´–í–ö–æ–Ω—Ç–∞–∫—Ç–µ¬ª

``` javascript
const vkflow = require('vkflow');

const stream = vkflow(
  VK_SERVICE_KEY,
  [ { value: '–≤–∫–æ–Ω—Ç–∞–∫—Ç–µ', tag: 'cyrillic' }
  , { value: 'vk', tag: 'latin' }
  ]
);

stream.on('data', console.log);
```

–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ `'data'` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω–æ [—Å–æ–æ–±—â–µ–Ω–∏–µ](https://vk.com/dev/streaming_api_docs_2?f=7.%20%D0%A7%D1%82%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BF%D0%BE%D1%82%D0%BE%D0%BA%D0%B0) –ø–æ—Ç–æ–∫–∞ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ JSON. [–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è](https://vk.com/dev/streaming_api_docs_2?f=7.1.%20Service%20message) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è. –£–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–º–µ–Ω—è—Ç —Å–æ–±–æ–π —Ç–µ, —á—Ç–æ –±—ã–ª–∏ –∑–∞–¥–∞–Ω—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Ä–∞–Ω–µ–µ, –µ—Å–ª–∏ —Ç–∞–∫–∏–µ –µ—Å—Ç—å. –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è `vkflow` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ [–æ—à–∏–±–æ–∫](https://vk.com/dev/streaming_api_docs_2?f=8.%20%D0%A1%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%BE%D0%B1%20%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0%D1%85) —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `'error'` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—ä–µ–∫—Ç–æ–º –æ—à–∏–±–∫–∏.

–û–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–±—Ä–∏–∫–∞, –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç [Readable Stream](https://nodejs.org/api/stream.html#stream_readable_streams), –ø–æ—ç—Ç–æ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –Ω–æ –∏ –ø–æ—Ç–æ–∫–æ–≤—ã–π.

##### –ü—Ä–∏–º–µ—Ä: —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –ø–æ—Ç–æ–∫–∞ –≤ —Ñ–∞–π–ª —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Node Streams:

``` javascript
const { createWriteStream } = require('fs')
const vkflow = require('vkflow')

vkflow(VK_SERVICE_KEY, rules)
  .pipe(createWriteStream('destination.dat'))
```

## üçØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `VKStreamingAPI` –∏ `VKWebSocket`

–§–∞–±—Ä–∏–∫–∞ `vkflow` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ —Å –ø—Ä–µ–¥–∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å VK Streaming API, —Ç–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –±–æ–ª–µ–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ `VKStreamingAPI` –∏ `VKWebSocket`.

### `VKStreamingAPI`

`VKStreamingAPI` ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è HTTP –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å VK Streaming API: —Å –ø–æ–º–æ—â—å—é –Ω–µ–≥–æ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞) –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–æ—Ç–æ–∫–∞.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:

#### `VKStreamingAPI.authWithToken` *(serviceKey:String) ‚Üí Promise*

- `serviceKey` ‚Äî [—Å–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](https://vk.com/dev/access_token?f=3.%20%D0%A1%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BD%D1%8B%D0%B9%20%D0%BA%D0%BB%D1%8E%D1%87%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0) –í–ö–æ–Ω—Ç–∞–∫—Ç–µ.

–í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é VK Streaming API –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è —Å –æ–±—ä–µ–∫—Ç–æ–º –≤–∏–¥–∞ `{ key: String, endpoint: String }`, –≥–¥–µ key —ç—Ç–æ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞, –∞ endpoint —ç—Ç–æ URL –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã c API. –ù–∞–ø—Ä–∏–º–µ—Ä:

``` javascript
{ endpoint: 'streaming.vk.com',
  key: '49e4758265efca1bb0bfceec9a08272b5d015ba0' }
```

> –í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –¥–∞–ª–µ–µ –º–µ—Ç–æ–¥–∞—Ö endpoint –∏ key ‚Äî —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é `VKStreamingAPI.authWithToken`

#### `VKStreamingAPI.getRules` *(endpoint:String, key:String) ‚Üí Promise*

–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Ç–æ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è —Å –æ–±—ä–µ–∫—Ç–æ–º –≤–∏–¥–∞:

``` javascript
{ code: 200,
  rules:
   [ { tag: 'candidate1', value: '—Ç–∏—Ç–æ–≤ -–µ–≥–æ—Ä' },
     { tag: 'candidate2', value: '—Å–æ–±—á–∞–∫' },
     { tag: 'candidate3', value: '–Ω–∞–≤–∞–ª—å–Ω—ã–π' },
     { tag: 'candidate4', value: '–ø—É—Ç–∏–Ω' },
     { tag: 'candidate5', value: '–∂–∏—Ä–∏–Ω–æ–≤—Å–∫–∏–π' },
     { tag: 'candidate6', value: '—è–≤–ª–∏–Ω—Å–∫–∏–π' },
     { tag: 'candidate7', value: '–≥—Ä—É–¥–∏–Ω–∏–Ω' } ] }
```

#### `VKStreamingAPI.postRule` *(endpoint:String, key:String, rule:Object) ‚Üí Promise*

–î–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –≤ –ø–æ—Ç–æ–∫. –ó–¥–µ—Å—å `rule` ‚Äî —ç—Ç–æ [–æ–±—ä–µ–∫—Ç –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –ø—Ä–∞–≤–∏–ª–æ](https://vk.com/dev/streaming_api_docs?f=5.%20%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB), –Ω–∞–ø—Ä–∏–º–µ—Ä:

``` javascript
{ rule: { tag: 'candidate2', value: '—Å–æ–±—á–∞–∫' } }
```

#### `VKStreamingAPI.deleteRule` *(endpoint:String, key:String, ruleTag:Object) ‚Üí Promise*

–£–¥–∞–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –∏–∑ –ø–æ—Ç–æ–∫–∞. –ó–¥–µ—Å—å `ruleTag` ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç –≤–∏–¥–∞:

``` javascript
{ tag: 'candidate2' }
```

#### `VKStreamingAPI.flushRules` *(endpoint:String, key:String) ‚Üí Promise*

–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—Ç–æ–∫–∞.

#### `VKStreamingAPI.getSettings` *(serviceKey:String) ‚Üí Promise*

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º monthly_limit (string), –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ tier_1-tier_6 –∏–ª–∏ unlimited –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É –ø–æ—Ä–æ–≥—É –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### `VKStreamingAPI.getStats` *(serviceKey:String, params:Object) ‚Üí Promise*

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π Streaming API. `params` ‚Äî –æ–±—ä–µ–∫—Ç —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –æ—Ç—á–µ—Ç—É, —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: [https://vk.com/dev/streaming.getStats](https://vk.com/dev/streaming.getStats).

#### `VKStreamingAPI.getStem` *(serviceKey:String, params:Object) ‚Üí Promise*

–õ–µ–º–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–ª–æ–≤–æ, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –≤ –ø–æ–ª–µ `word` –æ–±—ä–µ–∫—Ç–∞ `params`.

### `VKWebSocket`

`VKWebSocket` ‚Äî –∫–ª–∞—Å—Å –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ websocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ VK Streaming API. –ö–∞–∫ –∏ –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–π —Ñ–∞–±—Ä–∏–∫–æ–π `vkflow`, –∏–Ω—Å—Ç–∞–Ω—Å `VKWebSocket` –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç Readable Stream, –∞ –∑–Ω–∞—á–∏—Ç —á—Ç–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –∫–∞–∫ —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏—è `data`, —Ç–∞–∫ –∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `pipe`.

–î–ª—è –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è `VKWebSocket` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

##### –ü—Ä–∏–º–µ—Ä: —á—Ç–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º VKWebSocket

``` javascript
const VKWebSocket = require('vkflow').VKWebSocket;
const { authWithToken } = require('vkflow').VKStreamingAPI;

(async () => {
  const { endpoint, key } = await authWithToken(VK_SERVICE_KEY);

  const socket = new VKWebSocket(
      `wss://${endpoint}/stream?key=${key}`,
      { socket: { omitServiceMessages: false } }
    )

  socket.pipe(someWritableStream)
})()
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

- `highWaterMark` (Number) ‚Äî —Ä–∞–∑–º–µ—Ä [–±—É—Ñ–µ—Ä–∞](https://nodejs.org/api/stream.html#stream_readable_readablehighwatermark) —Å–æ–æ–±—â–µ–Ω–∏–π. Default: `32768`;
- `socket.debug` (Boolean) ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—á–µ—Ä–µ–∑ console.debug()) Default: `false`;
- `socket.omitServiceMessages` (Boolean) ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –Ω–µ—Ç [—Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è](https://vk.com/dev/streaming_api_docs_2?f=7.1.%20Service%20message) Default: `true`;
- `socket.reconnectInterval` (Number) ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. Default: `1e3`;
- `socket.maxReconnectInterval` (Number) ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. Default: `3e4`;
- `socket.reconnectDecay` (Number) ‚Äî –º–Ω–æ–∂–∏—Ç–µ–ª—å –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–æ—Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. Default: `1.5`;
- `socket.timeoutInterval` (Number) ‚Äî –≤—Ä–µ–º—è —Ç–∞–π–º–∞—É—Ç–∞ –æ–¥–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. Default: `2e3`;
- `socket.maxReconnectAttempts` (Number) ‚Äî –ª–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. Default: `null` (–Ω–µ—Ç –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫)

##### –ü—Ä–∏–º–µ—Ä: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `VKStreamingAPI` –∏ `VKWebSocket`

``` javascript
const VKWebSocket = require('vkflow').VKWebSocket;
const { authWithToken, flushRules, postRule } = require('vkflow').VKStreamingAPI;

const rules = [
    { tag: 'candidate1', value: '—Ç–∏—Ç–æ–≤ -–µ–≥–æ—Ä' },
    { tag: 'candidate2', value: '—Å–æ–±—á–∞–∫' },
    { tag: 'candidate3', value: '–Ω–∞–≤–∞–ª—å–Ω—ã–π' },
    { tag: 'candidate4', value: '–ø—É—Ç–∏–Ω' },
    { tag: 'candidate5', value: '–∂–∏—Ä–∏–Ω–æ–≤—Å–∫–∏–π' },
    { tag: 'candidate6', value: '—è–≤–ª–∏–Ω—Å–∫–∏–π' },
    { tag: 'candidate7', value: '–≥—Ä—É–¥–∏–Ω–∏–Ω' }
  ];

/**
 * –í—ã–ø–æ–ª–Ω–∏–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, —É–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ –ø–æ—Ç–æ–∫–∞, —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–µ
 * –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º websocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫a
 */

(async () => {
  const { endpoint, key } = await authWithToken(VK_SERVICE_KEY);

  await flushRules(endpoint, key);

  for (let rule of rules)
    await postRule(endpoint, key, { rule });

  const socket = new VKWebSocket(
      `wss://${endpoint}/stream?key=${key}`,
      { socket: { omitServiceMessages: false } }
    )

  socket.pipe(process.stdout)
})()
```
